# Go ä»£ç æ··æ·†å™¨ (Cross-File Obfuscator)
 Go ä»£ç æ··æ·†å·¥å…·ï¼Œä½¿ç”¨ AST (æŠ½è±¡è¯­æ³•æ ‘) æŠ€æœ¯å®ç°è·¨æ–‡ä»¶çš„ä»£ç æ··æ·†ï¼ŒåŒæ—¶ä¿è¯æ··æ·†åçš„ä»£ç **å¯ç¼–è¯‘å’Œå¯æ‰§è¡Œ**ã€‚

[English][url-docen]

## æ ¸å¿ƒäº®ç‚¹

- **ä¸€é”®è‡ªåŠ¨æ¨¡å¼** - å…¨åŠŸèƒ½æ··æ·† + è‡ªåŠ¨ç¼–è¯‘ï¼Œä¸€æ¡å‘½ä»¤æå®š
- **ç¬¬ä¸‰æ–¹åŒ…æ··æ·†** - å¯é€‰æ··æ·†ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œè¿›ä¸€æ­¥éšè—ä»£ç ä¿¡æ¯
- **é“¾æ¥å™¨çº§åˆ«æ··æ·†** - ç›´æ¥ä¿®æ”¹äºŒè¿›åˆ¶æ–‡ä»¶æ··æ·†å‡½æ•°åå’ŒåŒ…è·¯å¾„
- **è‡ªåŠ¨åŒ…åå‘ç°** - æ™ºèƒ½å‘ç°å¹¶æ··æ·†é¡¹ç›®åŒ…åã€æ ‡å‡†åº“åŒ…å
- **æ™ºèƒ½åŒºåŸŸä¿æŠ¤** - embed æ–‡ä»¶æ™ºèƒ½ä¿æŠ¤ï¼Œä¸ä¼šç ´åå†…åµŒèµ„æº
- **å¤šå±‚æ··æ·†æŠ€æœ¯** - å˜é‡å+å‡½æ•°å+å­—ç¬¦ä¸²åŠ å¯†+æ§åˆ¶æµæ··æ·†+äºŒè¿›åˆ¶æ··æ·†
- **æ™ºèƒ½ä¿æŠ¤æœºåˆ¶** - è‡ªåŠ¨è¯†åˆ«å’Œä¿æŠ¤å¯¼å‡ºç¬¦å·ã€ç»“æ„ä½“å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰
- **åå°„è‡ªåŠ¨ä¿æŠ¤** - æ£€æµ‹å¹¶ä¿æŠ¤ä½¿ç”¨åå°„çš„ç±»å‹å’Œæ–¹æ³•
- **JSON/XML æ™ºèƒ½å¤„ç†** - è‡ªåŠ¨ä¿æŠ¤åºåˆ—åŒ–ç›¸å…³çš„å­—æ®µå’Œç±»å‹
- **æ¥å£å®Œæ•´ä¿æŠ¤** - è‡ªåŠ¨ä¿æŠ¤æ¥å£å®šä¹‰å’Œå®ç°ï¼Œç¡®ä¿ä¸ç ´åå¤šæ€æ€§
- **åµŒå…¥å­—æ®µæ”¯æŒ** - æ­£ç¡®å¤„ç†åŒ¿ååµŒå…¥å­—æ®µï¼ˆç»“æ„ä½“å’ŒæŒ‡é’ˆï¼‰
- **å†…ç½®æ ‡è¯†ç¬¦ä¿æŠ¤** - ä¿æŠ¤æ‰€æœ‰ Go å†…ç½®ç±»å‹ã€å‡½æ•°å’Œå¸¸é‡
- **CGO æ™ºèƒ½è·³è¿‡** - è‡ªåŠ¨æ£€æµ‹å¹¶è·³è¿‡ CGO ä»£ç æ–‡ä»¶
- **ç”Ÿæˆä»£ç è¯†åˆ«** - è‡ªåŠ¨è·³è¿‡ protobuf ç­‰ç”Ÿæˆçš„ä»£ç 
- **çµæ´»æ’é™¤è§„åˆ™** - æ”¯æŒè‡ªå®šä¹‰æ–‡ä»¶æ’é™¤æ¨¡å¼
- **é«˜æ€§èƒ½** - ASTéå†ä¼˜åŒ–ï¼Œå¤„ç†é€Ÿåº¦å¿«
- **å¼ºéšæœºæ€§** - æ‰€æœ‰æ··æ·†åç§°å®Œå…¨éšæœºï¼Œæ— è§„å¾‹å¯å¾ª
- **è¯¦ç»†æŠ¥å‘Š** - è¿è¡Œæ—¶æ˜¾ç¤ºè·³è¿‡æ–‡ä»¶ã€åå°„ä½¿ç”¨ç­‰è¯¦ç»†ä¿¡æ¯

## ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½

1. **ç§æœ‰å‡½æ•°åæ··æ·†**
   - åªæ··æ·†æœªå¯¼å‡ºï¼ˆå°å†™å¼€å¤´ï¼‰çš„å‡½æ•°
   - ä¿æŒè·¨æ–‡ä»¶å¼•ç”¨çš„ä¸€è‡´æ€§
   - ç”Ÿæˆéšæœºä¸å¯é¢„æµ‹çš„å‡½æ•°å

2. **ç§æœ‰å˜é‡åæ··æ·†**
   - æ··æ·†å±€éƒ¨å˜é‡å’Œå…¨å±€æœªå¯¼å‡ºå˜é‡
   - æ™ºèƒ½åŒºåˆ†åŒåçš„å‡½æ•°å’Œå˜é‡
   - ä½¿ç”¨éšæœºå­—ç¬¦ä¸²å‘½å

3. **æ ‡å‡†åº“åŒ…åˆ«å** 
   - **è‡ªåŠ¨è¯†åˆ«**æ ‡å‡†åº“åŒ…ï¼ˆæ— éœ€æ‰‹åŠ¨ç»´æŠ¤åˆ—è¡¨ï¼‰
   - åªæ··æ·†æ ‡å‡†åº“ï¼Œç¬¬ä¸‰æ–¹åŒ…ä¿æŒåŸæ ·
   - ä¸ºæ‰€æœ‰æ ‡å‡†åº“åŒ…åˆ›å»ºä¸€è‡´çš„éšæœºåˆ«å
   - è‡ªåŠ¨æ›¿æ¢ä»£ç ä¸­çš„åŒ…å¼•ç”¨
   - é˜²æ­¢é€šè¿‡åŒ…åæ¨æµ‹ä»£ç åŠŸèƒ½

4. **æ™ºèƒ½ä¿æŠ¤æœºåˆ¶**
   
   **åŸºç¡€ä¿æŠ¤**ï¼š
   -  **å¯¼å‡ºç¬¦å·ä¿æŠ¤** - é»˜è®¤ä¸æ··æ·†å¯¼å‡ºçš„å‡½æ•°ã€å˜é‡ã€ç±»å‹ï¼ˆå¤§å†™å¼€å¤´ï¼‰
   -  **ç»“æ„ä½“å­—æ®µä¿æŠ¤** - ä¿æŠ¤æ‰€æœ‰ç»“æ„ä½“å­—æ®µåï¼ˆåŒ…æ‹¬åŒ¿ååµŒå…¥å­—æ®µï¼‰
   -  **æ–¹æ³•ä¿æŠ¤** - ä¿æŠ¤æ‰€æœ‰å¸¦æ¥æ”¶è€…çš„æ–¹æ³•å
   -  **æ¥å£ä¿æŠ¤** - è‡ªåŠ¨ä¿æŠ¤æ¥å£å®šä¹‰ä¸­çš„æ‰€æœ‰æ–¹æ³•ç­¾å
   
   **é€‰æ‹©å™¨æ™ºèƒ½ä¿æŠ¤**ï¼š
   -  ä¿æŠ¤å¤–éƒ¨åŒ…å’Œæ ‡å‡†åº“çš„é€‰æ‹©å™¨ï¼ˆå¦‚ `fmt.Println`ã€`os.Open`ï¼‰
   -  ä¿æŠ¤å¯¹è±¡æ–¹æ³•è°ƒç”¨ï¼ˆå¦‚ `obj.Method()`ã€`conn.Close()`ï¼‰
   -  å…è®¸æ··æ·†é¡¹ç›®å†…éƒ¨åŒ…çš„è·¨æ–‡ä»¶å¼•ç”¨ï¼ˆä¿æŒä¸€è‡´æ€§ï¼‰
   
   **åŒ…åä¿æŠ¤**ï¼š
   -  ä¿æŠ¤æ‰€æœ‰å¯¼å…¥çš„åŒ…åï¼ˆåŒ…æ‹¬æ ‡å‡†åº“å’Œç¬¬ä¸‰æ–¹åŒ…ï¼‰
   -  æ ‡å‡†åº“ä½¿ç”¨éšæœºåˆ«åï¼ˆå¦‚ `import p8xK2mQr "fmt"`ï¼‰
   -  ç¬¬ä¸‰æ–¹åŒ…ä¿æŒåŸæ ·ï¼ˆç¡®ä¿å…¼å®¹æ€§ï¼‰
   
   **å†…ç½®æ ‡è¯†ç¬¦ä¿æŠ¤**ï¼ˆ33+ä¸ªï¼‰ï¼š
   -  ç‰¹æ®Šæ ‡è¯†ç¬¦ï¼š`main`ã€`init`ã€`_`
   -  å†…ç½®ç±»å‹ï¼š`int`ã€`string`ã€`bool`ã€`byte`ã€`rune`ã€`error`ã€`float32`ã€`float64`ã€`complex64`ã€`complex128`ã€`uint`ã€`int8`ã€`int16`ã€`int32`ã€`int64`ã€`uint8`ã€`uint16`ã€`uint32`ã€`uint64`ã€`uintptr`
   -  å†…ç½®å‡½æ•°ï¼š`len`ã€`cap`ã€`make`ã€`new`ã€`append`ã€`copy`ã€`delete`ã€`panic`ã€`recover`ã€`print`ã€`println`ã€`close`ã€`min`ã€`max`ã€`clear`
   -  å†…ç½®å¸¸é‡ï¼š`nil`ã€`true`ã€`false`ã€`iota`

### é«˜çº§æ··æ·†åŠŸèƒ½

5. **å­—ç¬¦ä¸²åŠ å¯†** 
   - XOR åŠ å¯†æ‰€æœ‰å­—ç¬¦ä¸²å­—é¢é‡
   - éšæœºç”Ÿæˆè§£å¯†å‡½æ•°å
   - è¿è¡Œæ—¶è‡ªåŠ¨è§£å¯†
   - 64å­—èŠ‚éšæœºå¯†é’¥

6. **å¸¸é‡è¡¨è¾¾å¼åŒ–** 
   - å°†æ•°å­—å¸¸é‡è½¬æ¢ä¸ºæ•°å­¦è¡¨è¾¾å¼
   - ä¾‹å¦‚ï¼š`999999` â†’ `(1000*1000-1)`
   - å¢åŠ é™æ€åˆ†æéš¾åº¦

7. **æ³¨é‡Šåˆ é™¤** 
   - è‡ªåŠ¨ç§»é™¤æ‰€æœ‰ä»£ç æ³¨é‡Š
   - åŒ…æ‹¬æ–‡æ¡£æ³¨é‡Šã€è¡Œå†…æ³¨é‡Š
   - éšè—å¼€å‘è€…æ„å›¾å’Œè¯´æ˜

8. **ä¸é€æ˜è°“è¯** 
   - æ³¨å…¥åŸºäºæ•°å­¦çš„ä¸é€æ˜è°“è¯
   - ä½¿ç”¨æ°¸çœŸ/æ°¸å‡æ¡ä»¶æ··æ·†æ§åˆ¶æµ
   - åŒ…æ‹¬ï¼šxÂ²â‰¥0, (xÂ²+x)%2==0, 2x>x ç­‰
   - æ‰€æœ‰å˜é‡åéšæœºç”Ÿæˆ

## ä½¿ç”¨æ–¹æ³•

### ç¼–è¯‘

```bash
go build -o cross-file-obfuscator cmd/main.go
```

#### æ³¨æ„äº‹é¡¹

1. **CGO ä»£ç **ï¼š
   - å¦‚æœé¡¹ç›®åŒ…å« CGO ä»£ç ï¼Œäº¤å‰ç¼–è¯‘éœ€è¦å¯¹åº”å¹³å°çš„ C ç¼–è¯‘å™¨
   - å»ºè®®äº¤å‰ç¼–è¯‘æ—¶ç¦ç”¨ CGOï¼š`CGO_ENABLED=0`
   - æˆ–ä½¿ç”¨ `-exclude` å‚æ•°æ’é™¤ CGO æ–‡ä»¶

2. **å¹³å°ç‰¹å®šä»£ç **ï¼š
   - Build æ ‡ç­¾æ–‡ä»¶ï¼ˆ`_linux.go`, `_windows.go`ï¼‰ä¼šè‡ªåŠ¨å¤„ç†
   - Go ç¼–è¯‘å™¨ä¼šæ ¹æ® GOOS/GOARCH è‡ªåŠ¨é€‰æ‹©å¯¹åº”æ–‡ä»¶

3. **æ–‡ä»¶æ‰©å±•å**ï¼š
   - Windows å¹³å°å»ºè®®ä½¿ç”¨ `.exe` æ‰©å±•å
   - Linux/macOS å¹³å°é€šå¸¸ä¸éœ€è¦æ‰©å±•å

4. **strip å·¥å…·**ï¼š
   - é“¾æ¥å™¨æ··æ·†ä¼šè‡ªåŠ¨è°ƒç”¨ `strip` ç§»é™¤ç¬¦å·è¡¨
   - äº¤å‰ç¼–è¯‘æ—¶ï¼Œstrip å¯èƒ½ä¸æ”¯æŒç›®æ ‡å¹³å°æ ¼å¼
   - å·¥å…·ä¼šå°è¯•ä½¿ç”¨ï¼Œå¤±è´¥æ—¶ä¼šç»™å‡ºè­¦å‘Šä½†ä¸å½±å“æ··æ·†

### åŸºæœ¬ç”¨æ³•

```bash
# åŸºç¡€æ··æ·†ï¼ˆå˜é‡åã€å‡½æ•°åã€åŒ…åˆ«åï¼‰
./cross-file-obfuscator <é¡¹ç›®ç›®å½•>

# ä½¿ç”¨æ‰€æœ‰é«˜çº§åŠŸèƒ½ï¼ˆæ¨èï¼‰
./cross-file-obfuscator -obfuscate-exported -obfuscate-filenames -encrypt-strings -inject-junk -remove-comments <é¡¹ç›®ç›®å½•>
```

### å‘½ä»¤è¡Œé€‰é¡¹

#### åŸºç¡€é€‰é¡¹

```bash
-o <ç›®å½•>                    æŒ‡å®šè¾“å‡ºç›®å½•ï¼ˆé»˜è®¤ï¼šé¡¹ç›®å_obfuscatedï¼‰
-obfuscate-exported          æ··æ·†å¯¼å‡ºçš„å‡½æ•°å’Œå˜é‡ï¼ˆå¯èƒ½ç ´åAPIï¼‰
-obfuscate-filenames         æ··æ·† Go æ–‡ä»¶å
-encrypt-strings             åŠ å¯†å­—ç¬¦ä¸²å­—é¢é‡
-inject-junk                 æ³¨å…¥åƒåœ¾ä»£ç ï¼ˆä¸é€æ˜è°“è¯ï¼‰
-remove-comments             åˆ é™¤æ‰€æœ‰æ³¨é‡Šï¼ˆé»˜è®¤ï¼štrueï¼‰
-preserve-reflection         ä¿æŠ¤åå°„ç›¸å…³çš„ç±»å‹å’Œæ–¹æ³•ï¼ˆé»˜è®¤ï¼štrueï¼‰
-skip-generated              è·³è¿‡è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç æ–‡ä»¶ï¼ˆé»˜è®¤ï¼štrueï¼‰
-exclude <æ¨¡å¼>              æ’é™¤æ–‡ä»¶æ¨¡å¼ï¼Œé€—å·åˆ†éš”ï¼ˆå¦‚ï¼š'*_test.go,*.pb.go,tools/*'ï¼‰
```

#### é«˜çº§é€‰é¡¹ï¼ˆé“¾æ¥å™¨æ··æ·†ï¼‰

```bash
-auto                        è‡ªåŠ¨æ¨¡å¼ï¼šå…¨åŠŸèƒ½æ··æ·† + è‡ªåŠ¨ç¼–è¯‘ï¼ˆæ¨èï¼ŒWindows ä¸‹è‡ªåŠ¨ä½¿ç”¨æœ€å°åŒ– pclntabï¼‰
-build-with-linker           ç›´æ¥ç¼–è¯‘å¹¶åº”ç”¨é“¾æ¥å™¨æ··æ·†
-output-bin <æ–‡ä»¶å>         è¾“å‡ºäºŒè¿›åˆ¶æ–‡ä»¶åï¼ˆé…åˆ -build-with-linker æˆ– -auto ä½¿ç”¨ï¼‰
-entry <åŒ…è·¯å¾„>              å…¥å£åŒ…è·¯å¾„ï¼ˆå¤šå…¥å£é¡¹ç›®å¿…é¡»æŒ‡å®šï¼‰
                             - é»˜è®¤: "." (æ ¹ç›®å½•)
                             - ç¤ºä¾‹: "./cmd/server", "./cmd/gost"
                             - ç”¨äºæŒ‡å®šmainåŒ…ä½ç½®
-pkg-replace <æ˜ å°„>          åŒ…åæ›¿æ¢æ˜ å°„ï¼ˆæ ¼å¼: 'original1=new1,original2=new2'ï¼‰
-auto-discover-pkgs          è‡ªåŠ¨å‘ç°å¹¶æ›¿æ¢é¡¹ç›®ä¸­çš„æ‰€æœ‰åŒ…åï¼ˆæ¨èï¼‰
-obfuscate-third-party       æ··æ·†ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…ï¼ˆè°¨æ…ä½¿ç”¨ï¼Œå¯èƒ½å½±å“ç¨³å®šæ€§ï¼‰
-only-project                åªæ··æ·†é¡¹ç›®åŒ…ï¼Œä¿ç•™æ ‡å‡†åº“ï¼ˆæœ€å°åŒ– pclntabï¼Œæ¨è Windowsï¼‰
-disable-pclntab             å®Œå…¨ç¦ç”¨ pclntab ä¿®æ”¹ï¼ˆæœ€å®‰å…¨ä½†ä¿æŠ¤è¾ƒå¼±ï¼‰
```

**`-entry` å‚æ•°è¯´æ˜**ï¼š

- **ä½•æ—¶éœ€è¦**ï¼šå½“ä½ çš„mainåŒ…ä¸åœ¨é¡¹ç›®æ ¹ç›®å½•æ—¶ï¼ˆå¦‚ `cmd/app/main.go`ï¼‰
- **å¦‚ä½•ç¡®å®š**ï¼šè¿è¡Œ `find ./project -name "*.go" -exec grep -l "func main()" {} \;`
- **å¸¸è§åœºæ™¯**ï¼š
  - `main.go` åœ¨æ ¹ç›®å½• â†’ æ— éœ€æŒ‡å®š
  - `cmd/server/main.go` â†’ éœ€è¦ `-entry "./cmd/server"`
  - `cmd/gost/main.go` â†’ éœ€è¦ `-entry "./cmd/gost"`

### ä½¿ç”¨ç¤ºä¾‹

#### ğŸš€ æ¨èï¼šè‡ªåŠ¨æ¨¡å¼

```bash
# æ ‡å‡†é¡¹ç›®ï¼ˆmainåœ¨æ ¹ç›®å½•ï¼‰
./cross-file-obfuscator -auto -output-bin myapp ./my-project

# å¤šå…¥å£é¡¹ç›®ï¼ˆmainåœ¨å­ç›®å½•ï¼‰- å¿…é¡»æŒ‡å®š -entry
./cross-file-obfuscator -auto -entry "./cmd/server" -output-bin server ./my-project

```

#### é“¾æ¥å™¨æ··æ·†ç¤ºä¾‹

```bash
# æ ‡å‡†é¡¹ç›® - è‡ªåŠ¨å‘ç°åŒ…åï¼ˆæ¨èï¼‰
./cross-file-obfuscator -build-with-linker -auto-discover-pkgs -output-bin myapp ./my-project

# å¤šå…¥å£é¡¹ç›® - éœ€è¦æŒ‡å®šentry
./cross-file-obfuscator -build-with-linker -auto-discover-pkgs -entry "./cmd/server" -output-bin server ./my-project

# é“¾æ¥å™¨æ··æ·† + ç¬¬ä¸‰æ–¹åŒ…æ··æ·†
./cross-file-obfuscator -build-with-linker -auto-discover-pkgs -obfuscate-third-party -output-bin myapp ./my-